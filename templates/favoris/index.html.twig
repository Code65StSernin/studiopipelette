{% extends 'base.html.twig' %}

{% block title %}Mes Favoris - Studio Pipelette{% endblock %}

{% block content_right %}
    <!-- Page Header intégré dans la colonne de droite -->
    <div class="bg-secondary mb-4 p-4">
        <div class="d-flex flex-column">
            <h3 class="font-weight-semi-bold text-uppercase mb-2">Mes Favoris</h3>
            <nav class="d-inline-flex">
                <a href="{{ path('app_home') }}" class="text-dark">Accueil</a>
                <span class="mx-2">-</span>
                <span class="text-dark">Favoris</span>
            </nav>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12">
            {% if favori.isEmpty %}
                <!-- Favoris vides -->
                <div class="card border-secondary mb-5">
                    <div class="card-body text-center py-5">
                        <i class="fa fa-heart fa-5x text-secondary mb-4"></i>
                        <h3 class="mb-4">Votre liste de favoris est vide</h3>
                        <p class="text-muted mb-4">Ajoutez des articles à vos favoris en cliquant sur le cœur</p>
                        <a href="{{ path('app_boutique') }}" class="btn btn-primary py-2 px-4">
                            <i class="fa fa-arrow-left mr-2"></i>Découvrir nos bougies
                        </a>
                    </div>
                </div>
            {% else %}
                <!-- Liste des favoris -->
                <div class="card border-secondary mb-5">
                    <div class="card-header bg-secondary border-0">
                        <div class="d-flex justify-content-between align-items-center">
                            <h4 class="font-weight-semi-bold m-0">Articles favoris ({{ favori.nombreArticles }})</h4>
                            <form method="post" action="{{ path('app_favoris_vider') }}" 
                                  onsubmit="return confirm('Êtes-vous sûr de vouloir vider vos favoris ?');">
                                <button type="submit" class="btn btn-sm btn-outline-danger">
                                    <i class="fa fa-times mr-1"></i>Vider les favoris
                                </button>
                            </form>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row pb-3">
                            {% for article in favori.articles %}
                                <div class="col-lg-3 col-md-4 col-sm-6 pb-1">
                                    <div class="card product-item border-0 mb-4">
                                        <div class="card-header product-img position-relative overflow-hidden bg-transparent border p-0">
                                            <a href="{{ path('app_article_show', {'slug': article.slug}) }}">
                                                {% if article.photos|length > 0 %}
                                                    <img class="img-fluid w-100" src="{{ asset('assets/img/articles/' ~ article.id ~ '/' ~ article.photos|first.filename) }}" alt="{{ article.nom }}">
                                                {% else %}
                                                    <img class="img-fluid w-100" src="{{ asset('assets/img/product-1.jpg') }}" alt="{{ article.nom }}">
                                                {% endif %}
                                            </a>
                                            
                                            {# Badge sous-catégorie ou catégorie à gauche #}
                                            {% if article.sousCategorie %}
                                                <div class="badge badge-secondary text-white position-absolute" style="top: 10px; left: 10px; padding: 5px 10px;">
                                                    {{ article.sousCategorie.nom }}
                                                </div>
                                            {% elseif article.categorie %}
                                                <div class="badge badge-secondary text-white position-absolute" style="top: 10px; left: 10px; padding: 5px 10px;">
                                                    {{ article.categorie.nom }}
                                                </div>
                                            {% endif %}
                                        </div>
                                        <div class="card-body border-left border-right text-center p-0 pt-4 pb-3">
                                            <h6 class="text-truncate mb-3">{{ article.nom }}</h6>
                                            <div class="d-flex justify-content-center">
                                                {% set minPrice = article.prixMin %}
                                                {% set taillesCount = article.tailles|length %}
                                                {% if minPrice %}
                                                    <h6>
                                                        {% if taillesCount > 1 %}A partir de {% endif %}
                                                        {{ minPrice|number_format(2, ',', ' ') }}€
                                                    </h6>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="card-footer bg-light border">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <a href="{{ path('app_article_show', {'slug': article.slug}) }}" class="btn btn-sm text-dark p-0">
                                                    <i class="fas fa-eye text-primary mr-1"></i>Voir détails
                                                </a>
                                                <form method="post" action="{{ path('app_favoris_retirer', {id: article.id}) }}" style="display: inline;">
                                                    <button type="submit" class="btn btn-sm btn-danger p-0 px-2">
                                                        <i class="fa fa-trash"></i>
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <!-- Continuer les achats -->
                <div class="row">
                    <div class="col-12 text-center mb-5">
                        <a href="{{ path('app_boutique') }}" class="btn btn-primary py-3 px-5">
                            <i class="fa fa-arrow-left mr-2"></i>Continuer mes achats
                        </a>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}

